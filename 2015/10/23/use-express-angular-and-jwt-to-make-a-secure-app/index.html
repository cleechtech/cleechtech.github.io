<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<!-- Use use express, angular and jwt to make a secure app for dynamic title -->
	<title>El Blogo de Connor</title>

	<!-- Twitter bootstrap (via cdn) -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	<!-- assets located in source folder -->
	<link rel="stylesheet" href="/css/main.css">

</head>

<div class='row text-center'>
	<form action="//github.us5.list-manage.com/subscribe/post?u=0713e0ac2a414eae4ca4bb786&amp;id=0bdf2bdb00" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="navbar-form" target="_blank" novalidate>
	    <div class="form-group">
	    	<label for="mce-EMAIL">Get notified when I post a new tutorial!</label>
		    <input type="email" value="" name="EMAIL" class="form-control" placeholder="Email address" required>
		    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		    <div style="position: absolute; left: -5000px;" aria-hidden="true">
		    	<input type="text" name="b_0713e0ac2a414eae4ca4bb786_0bdf2bdb00" tabindex="-1" value="">
		    </div> 	
	    </div>
	    <input type="submit" value="Submit" name="subscribe" class="btn btn-warning">
	</form>
</div>
<body id='wrapper'>
	<div class='hideOverflow'>
		<div class='container blog-post'>
	<div class='row'>
		<div class='col-sm-12'>
			<a href='/' class="btn btn-yellow btn-circle" style='color:grey;'>
            	<i class="fa fa-home fa-2"></i>
        	</a>
		</div>
	</div>
	<div class='row'>
		<h1 class='author-name'>use express, angular and jwt to make a secure app</h1>
	    2015-10-23 
	    <hr />
		<p>Master authentication with fullstack javascript development<br><a id="more"></a></p>
<p><img src="http://media.giphy.com/media/3oEduWAFQjlfP5gMU0/giphy.gif" alt=""></p>
<p><a href="https://node-jwt-intro.herokuapp.com/" target="_blank" rel="external">DEMO</a></p>
<p><a href="https://github.com/jasonshark/node-jwt-intro" target="_blank" rel="external">SOURCE CODE</a></p>
<h3 id="Build_server">Build server</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/jasonshark/mean-starter</span><br></pre></td></tr></table></figure>
<p>Install some more packages:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="operator"><span class="keyword">install</span> jsonwebtoken bcrypt q <span class="comment">--save</span></span></span><br></pre></td></tr></table></figure>
<p>In <strong>server.js</strong> add a secret key. We will use the secret key to encrypt and decrypt the Json Web Tokens (JWTs).</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JWT config</span></span><br><span class="line"><span class="keyword">var</span> jwtSecret = <span class="string">'thupers3crT$12'</span>;</span><br><span class="line">app.<span class="keyword">set</span>(<span class="string">'superSecret'</span>, jwtSecret);</span><br></pre></td></tr></table></figure>
<p>Create a user schema in <strong>server/models/user.js</strong>:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> mongoose = <span class="keyword">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="built_in">var</span> Schema = mongoose<span class="built_in">.</span>Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">// email, pwd are required</span></span><br><span class="line"><span class="comment">// email must be unique</span></span><br><span class="line"><span class="comment">// don't send password with requests</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">var</span> userSchema = <span class="literal">new</span> Schema(&#123;</span><br><span class="line">	email: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span>, unique: <span class="literal">true</span> &#125;,</span><br><span class="line">	password: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span>, <span class="keyword">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">	admin: <span class="built_in">Boolean</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module<span class="built_in">.</span>exports = mongoose<span class="built_in">.</span>model(<span class="string">'User'</span>, userSchema);</span><br></pre></td></tr></table></figure>
<p>Like the comments say, email and passwords are required, emails must be unique and don’t send the password with the request. We are going to hash user passwords but it is still good practice to not expose that.</p>
<p><em>Hash password:</em> we are going to have a util for hashing and decrypting passwords. We will have these methods in <strong>server/utils.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bcrypt = <span class="built_in">require</span>(<span class="string">'bcrypt'</span>),</span><br><span class="line">	q = <span class="built_in">require</span>(<span class="string">'q'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// helper function for hashing users' passwords</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	comparePwd: <span class="function"><span class="keyword">function</span>(<span class="params">password, hash</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> dfd = q.defer();</span><br><span class="line"></span><br><span class="line">		bcrypt.compare(password, hash, <span class="function"><span class="keyword">function</span>(<span class="params">err, isMatch</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err) dfd.reject(err);</span><br><span class="line"></span><br><span class="line">			dfd.resolve(isMatch);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> dfd.promise;</span><br><span class="line">	&#125;,</span><br><span class="line">	hashPwd: <span class="function"><span class="keyword">function</span>(<span class="params">password</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> dfd = q.defer();</span><br><span class="line">		bcrypt.genSalt(<span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, salt</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err) dfd.reject(err);</span><br><span class="line"></span><br><span class="line">		    bcrypt.hash(password, salt, <span class="function"><span class="keyword">function</span>(<span class="params">err, hash</span>) </span>&#123;</span><br><span class="line">		    	<span class="keyword">if</span>(err) dfd.reject(err);</span><br><span class="line"></span><br><span class="line">		    	dfd.resolve(hash);</span><br><span class="line">		    &#125;);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> dfd.promise;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>set up routes in <strong>server/routes.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>),</span><br><span class="line">	path = <span class="built_in">require</span>(<span class="string">'path'</span>),</span><br><span class="line">	jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>),</span><br><span class="line">	utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>),</span><br><span class="line">	rootPath = path.normalize(__dirname + <span class="string">'/../'</span>),</span><br><span class="line">	apiRouter = express.Router(),</span><br><span class="line">	User = <span class="built_in">require</span>(<span class="string">'./models/user'</span>),</span><br><span class="line">	router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>)</span>&#123;	</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>Then make an api endpoint to add a user:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add user</span></span><br><span class="line">	apiRouter.post(<span class="string">'/users'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		utils.hashPwd(req.body.password).then(<span class="function"><span class="keyword">function</span><span class="params">(hashedPwd)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">var</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">				email: req.body.email,</span><br><span class="line">				password: hashedPwd,</span><br><span class="line">				admin: <span class="literal">false</span></span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">			newUser.save(<span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// create token</span></span><br><span class="line">				<span class="keyword">var</span> token = jwt.sign(newUser, app.<span class="keyword">get</span>(<span class="string">'superSecret'</span>), &#123; expiresInminutes: <span class="number">1440</span> &#125;);</span><br><span class="line"></span><br><span class="line">				newUser.password = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// send token</span></span><br><span class="line">				res.json(&#123;</span><br><span class="line">					success: <span class="literal">true</span>,</span><br><span class="line">					message: <span class="string">'Successfully authenticated!'</span>,</span><br><span class="line">					token: token,</span><br><span class="line">					user: newUser</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p>We create the user in the database, create a token and send that. Authenticate a user with this route:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// authenticate user</span></span><br><span class="line">apiRouter.post(<span class="string">'/users/auth'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// add back the password field for this query</span></span><br><span class="line">	<span class="keyword">var</span> query = User.findOne(&#123;</span><br><span class="line">		email: req.body.email</span><br><span class="line">	&#125;).select(<span class="string">'_id email +password'</span>);</span><br><span class="line"></span><br><span class="line">	query.exec(<span class="function"><span class="keyword">function</span><span class="params">(err, user)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!user)&#123;</span><br><span class="line">			res.json(&#123; success: <span class="literal">false</span>, message: <span class="string">'No user with that email'</span> &#125;);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(user)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// check password</span></span><br><span class="line">			utils.comparePwd(req.body.password, user.password).then(<span class="function"><span class="keyword">function</span><span class="params">(isMatch)</span></span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(!isMatch)&#123;</span><br><span class="line">					res.json(&#123; success: <span class="literal">false</span>, message: <span class="string">'Wrong password'</span> &#125;);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// create token</span></span><br><span class="line">					<span class="keyword">var</span> token = jwt.sign(user, app.<span class="keyword">get</span>(<span class="string">'superSecret'</span>), &#123; expiresInminutes: <span class="number">1440</span> &#125;);</span><br><span class="line"></span><br><span class="line">					user.password = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// send token</span></span><br><span class="line">					res.json(&#123;</span><br><span class="line">						success: <span class="literal">true</span>,</span><br><span class="line">						message: <span class="string">'Successfully authenticated!'</span>,</span><br><span class="line">						token: token,</span><br><span class="line">						user: user</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Then we’re going to have an endpoint to show all the users, but we are going to protect it with some middleware, namely an <code>authenticate</code> function.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apiRouter.<span class="keyword">get</span>(<span class="string">'/users'</span>, authenticate, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">		User.find(&#123;&#125;, <span class="function"><span class="keyword">function</span><span class="params">(err, users)</span></span>&#123;</span><br><span class="line">			res.json(users);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p>That function is defined as such:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware</span></span><br><span class="line">	function authenticate(req, res, next)&#123;</span><br><span class="line">	  <span class="keyword">var</span> <span class="keyword">token</span> = req.body.<span class="keyword">token</span> || req.<span class="keyword">query</span>.<span class="keyword">token</span> || req.headers['x-access-<span class="keyword">token</span>'];</span><br><span class="line"></span><br><span class="line">	  <span class="keyword">if</span> (<span class="keyword">token</span>) &#123;</span><br><span class="line"></span><br><span class="line">	  	<span class="comment">// verify token validity</span></span><br><span class="line">	    jwt.verify(<span class="keyword">token</span>, <span class="keyword">app</span>.<span class="literal">get</span>('superSecret'), function(<span class="keyword">err</span>, decoded) &#123;      </span><br><span class="line">	      <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</span><br><span class="line">	        <span class="keyword">return</span> res.json(&#123; success: false, message: 'Failed to authenticate <span class="keyword">token</span>.' &#125;);    </span><br><span class="line">	      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	        req.decoded = decoded;    </span><br><span class="line">	        next();</span><br><span class="line">	      &#125;</span><br><span class="line">	    &#125;);</span><br><span class="line"></span><br><span class="line">	  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">return</span> res.status(403).send(&#123; </span><br><span class="line">	        success: false, </span><br><span class="line">	        message: '<span class="keyword">No</span> <span class="keyword">token</span> provided.' </span><br><span class="line">	    &#125;);</span><br><span class="line">	    </span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>That’s all the server setup. Next we will deploy the app to heroku.</p>
<h3 id="Deploy_to_heroku">Deploy to heroku</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>heroku create &lt;app_name&gt;</span><br><span class="line"><span class="variable">$ </span>heroku <span class="symbol">config:</span>set <span class="constant">NODE_ENV</span>=production</span><br><span class="line"><span class="variable">$ </span>heroku <span class="symbol">addons:</span>create <span class="symbol">mongolab:</span>sandbox </span><br><span class="line"><span class="variable">$ </span>heroku config | grep <span class="constant">MONGOLAB_URI</span></span><br></pre></td></tr></table></figure>
<p>Add the mongolab uri to <strong>server/env.js</strong>. Then commit the change.<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git push heroku <span class="keyword">master</span></span><br><span class="line"><span class="title">$</span> heroku ps:scale <span class="variable">web=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Build_client">Build client</h3><p>Include libraries in <strong>public/index.html</strong>. We are going to use <a href="https://github.com/formly-js/angular-formly" target="_blank" rel="external">angular-formly</a> to keep things fresh. It also means we write more javascript and less html. woohoo!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- angular + router + bootstrap --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- angular-formly + dependency --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/api-check/7.5.0/api-check.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/angular-formly/6.21.1/formly.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/angular-formly-templates-bootstrap/6.0.0/angular-formly-templates-bootstrap.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- our custom js --&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><img src="http://media.giphy.com/media/QgpbrXUVhJqzm/giphy.gif" alt=""></p>
<p>Here is the module definition in <strong>public/js/app.js</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'jwtintro'</span>, [</span><br><span class="line">	<span class="string">'ui.router'</span>,</span><br><span class="line">	<span class="string">'formly'</span>,</span><br><span class="line">	<span class="string">'formlyBootstrap'</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$httpProvider</span>)</span></span>&#123;</span><br><span class="line">	<span class="comment">// will add token to header of requests if token is present</span></span><br><span class="line">	<span class="variable">$httpProvider</span>.interceptors.push(<span class="string">'authInterceptor'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.run(<span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$rootScope</span>, auth)</span></span>&#123;</span><br><span class="line">	<span class="comment">// if the user's data is in local storage</span></span><br><span class="line">	<span class="comment">// show them as signed in</span></span><br><span class="line">	<span class="keyword">var</span> user = auth.getUser();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(user)&#123;</span><br><span class="line">		<span class="variable">$rootScope</span>.user = JSON.parse(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.constant(<span class="string">'API_URL'</span>, <span class="string">'api/'</span>);</span><br><span class="line"></span><br><span class="line">app.config(<span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$stateProvider</span>, <span class="variable">$urlRouterProvider</span>)</span></span>&#123;</span><br><span class="line">	<span class="variable">$stateProvider</span></span><br><span class="line">		.state(<span class="string">'home'</span>, &#123;</span><br><span class="line">			url: <span class="string">"/"</span>,</span><br><span class="line">			templateUrl: <span class="string">"templates/main.html"</span>,</span><br><span class="line">			controller: <span class="string">'MainCtrl'</span></span><br><span class="line">		&#125;)</span><br><span class="line">		.state(<span class="string">'auth'</span>, &#123;</span><br><span class="line">			<span class="keyword">abstract</span>: <span class="keyword">true</span>,</span><br><span class="line">			templateUrl: <span class="string">'templates/auth/main.html'</span></span><br><span class="line">		&#125;)</span><br><span class="line">		.state(<span class="string">'auth.login'</span>, &#123;</span><br><span class="line">			url: <span class="string">"/login"</span>,</span><br><span class="line">			templateUrl: <span class="string">"templates/auth/login.html"</span>,</span><br><span class="line">			controller: <span class="string">'LoginCtrl'</span></span><br><span class="line">		&#125;)</span><br><span class="line">		.state(<span class="string">'auth.register'</span>, &#123;</span><br><span class="line">			url: <span class="string">"/register"</span>,</span><br><span class="line">			templateUrl: <span class="string">"templates/auth/register.html"</span>,</span><br><span class="line">			controller: <span class="string">'RegisterCtrl'</span></span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$urlRouterProvider</span>.otherwise(<span class="string">"/"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Bet you did not know that there is a third argument to module definitions. I did not. You like that nifty abstract state? Shit is cray. Alright moving on, controllers look like:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app.controller(<span class="string">'LoginCtrl'</span>, <span class="keyword">function</span>(<span class="variable">$rootScope</span>, <span class="variable">$scope</span>, user, <span class="variable">$state</span>)&#123;</span><br><span class="line">	<span class="variable">$scope</span>.userCreds = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$scope</span>.loginFields = [</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'email'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Email'</span>,</span><br><span class="line">				type: <span class="string">'email'</span>,</span><br><span class="line">				placeholder: <span class="string">'Valid email address'</span>,</span><br><span class="line">				required: true</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'password'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Password'</span>,</span><br><span class="line">				type: <span class="string">'password'</span>,</span><br><span class="line">				placeholder: <span class="string">'Password'</span>,</span><br><span class="line">				required: true</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	];</span><br><span class="line"></span><br><span class="line">	<span class="variable">$scope</span>.login = function(userCreds)&#123;</span><br><span class="line">		user.login(userCreds).then(function success(res)&#123;</span><br><span class="line">			// if successful, log user in</span><br><span class="line">			if(res.data.success)&#123;</span><br><span class="line">				<span class="variable">$rootScope</span>.user = res.data.user;</span><br><span class="line">				<span class="variable">$state</span>.go(<span class="string">'home'</span>);</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;, function handleError(res)&#123;</span><br><span class="line">			console.error(<span class="string">'Error: '</span> + JSON.stringify(res.data));</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$scope</span>.logout = function()&#123;</span><br><span class="line">		<span class="variable">$rootScope</span>.user = null;</span><br><span class="line">		user.logout();</span><br><span class="line"></span><br><span class="line">		// hard page refresh</span><br><span class="line">		<span class="variable">$state</span>.go(<span class="variable">$state</span>.current.name, <span class="variable">$state</span>.params, &#123; reload: true &#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.controller(<span class="string">'RegisterCtrl'</span>, <span class="keyword">function</span>(<span class="variable">$rootScope</span>, <span class="variable">$scope</span>, user, <span class="variable">$state</span>)&#123;</span><br><span class="line">	<span class="variable">$scope</span>.newUser = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$scope</span>.registerFields = [</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'email'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Email'</span>,</span><br><span class="line">				type: <span class="string">'email'</span>,</span><br><span class="line">				placeholder: <span class="string">'Valid email address'</span>,</span><br><span class="line">				required: true</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'password'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Password'</span>,</span><br><span class="line">				type: <span class="string">'password'</span>,</span><br><span class="line">				placeholder: <span class="string">'8 characters, number and special symbol'</span>,</span><br><span class="line">				required: true</span><br><span class="line">			&#125;,</span><br><span class="line">			validators: &#123;</span><br><span class="line">				checker: function(<span class="variable">$viewValue</span>, <span class="variable">$modelValue</span>, scope)&#123;</span><br><span class="line">					var attemptedPwd = <span class="variable">$viewValue</span> || <span class="variable">$modelValue</span>;</span><br><span class="line"></span><br><span class="line">					var REQUIRED_PATTERNS = [</span><br><span class="line">					    /\d+/,    //numeric values</span><br><span class="line">					    /[a-z]+/, //lowercase values</span><br><span class="line">					    /[A-Z]+/, //uppercase values</span><br><span class="line">					    /\W+/,    //special characters</span><br><span class="line">					    /^\S+$/   //no whitespace allowed</span><br><span class="line">					];</span><br><span class="line">					var status = true;</span><br><span class="line">					angular.forEach(REQUIRED_PATTERNS, function(pattern) &#123;</span><br><span class="line">						// check that the attempted password passes all tests</span><br><span class="line">						status = status &amp;&amp; pattern.test(attemptedPwd);</span><br><span class="line">					&#125;);</span><br><span class="line"></span><br><span class="line">					// must be at least eight characters</span><br><span class="line">					return (status &amp;&amp; attemptedPwd.length &gt;= <span class="number">8</span>)? true : false;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	];</span><br><span class="line"></span><br><span class="line">	<span class="variable">$scope</span>.register = function(newUser)&#123;</span><br><span class="line">		user.register(newUser).then(function success(res)&#123;</span><br><span class="line">			if(res.data.success)&#123;</span><br><span class="line">				<span class="variable">$rootScope</span>.user = res.data.user;</span><br><span class="line">				<span class="variable">$state</span>.go(<span class="string">'home'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, handleError);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	function handleError(res)&#123;</span><br><span class="line">		alert(<span class="string">'Error: '</span> + res.data);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>public/js/factories/auth.js</strong>:<br>Here we are going to store the user data and the token in the browser’s localStorage. We also define this funky httpInterceptor business. request is a special keyword. It acts similar to express middleware.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stores and removes jwt and user data</span></span><br><span class="line"><span class="comment">// from browser's local storage </span></span><br><span class="line"></span><br><span class="line">app.factory(<span class="string">'auth'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$window</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> store = $<span class="built_in">window</span>.localStorage;</span><br><span class="line">	<span class="keyword">var</span> key = <span class="string">'node-jwt-intro-auth-token'</span>;</span><br><span class="line">	<span class="keyword">var</span> userKey = <span class="string">'node-jwt-intro-user'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		getToken: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> store.getItem(key);</span><br><span class="line">		&#125;,</span><br><span class="line">		setToken: <span class="function"><span class="keyword">function</span>(<span class="params">token</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(token)&#123;</span><br><span class="line">				store.setItem(key, token);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				store.removeItem(key);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		getUser: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> store.getItem(userKey);</span><br><span class="line">		&#125;,</span><br><span class="line">		setUser: <span class="function"><span class="keyword">function</span>(<span class="params">user</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(user)&#123;</span><br><span class="line">				store.setItem(userKey, <span class="built_in">JSON</span>.stringify(user));</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				store.removeItem(userKey);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// if the user has logged in add a special header</span></span><br><span class="line">app.factory(<span class="string">'authInterceptor'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">auth</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		request: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> token = auth.getToken();</span><br><span class="line">			<span class="keyword">if</span>(token)&#123;</span><br><span class="line">				<span class="comment">// add custom header to every request when user has token</span></span><br><span class="line">				config.headers = config.headers || &#123;&#125;;</span><br><span class="line">				config.headers[<span class="string">'x-access-token'</span>] = token;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> config;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>In the user facory we will send requests for login, logout and register <strong>public/js/factories/user.js</strong>:</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app.factory(<span class="string">'user'</span>, <span class="function"><span class="keyword">function</span><span class="params">($http, auth, API_URL)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		login: <span class="function"><span class="keyword">function</span><span class="params">(userCreds)</span></span>&#123;</span><br><span class="line">			<span class="keyword">return</span> $http.post(API_URL + <span class="string">'users/auth'</span>, &#123;</span><br><span class="line">				email: userCreds.email,</span><br><span class="line">				password: userCreds.password</span><br><span class="line">			&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">				auth.setToken(res.<span class="type">data</span>.token);</span><br><span class="line">				auth.setUser(res.<span class="type">data</span>.user);</span><br><span class="line">				<span class="keyword">return</span> res;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;,</span><br><span class="line">		register: <span class="function"><span class="keyword">function</span><span class="params">(newUser)</span></span>&#123;</span><br><span class="line">			// create user</span><br><span class="line">			<span class="keyword">return</span> $http.post(API_URL + <span class="string">'users'</span>, &#123;</span><br><span class="line">				email: newUser.email,</span><br><span class="line">				password: newUser.password</span><br><span class="line">			&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">				// <span class="built_in">log</span> user <span class="type">in</span></span><br><span class="line">				auth.setToken(res.<span class="type">data</span>.token);</span><br><span class="line">				auth.setUser(res.<span class="type">data</span>.user);</span><br><span class="line">				<span class="keyword">return</span> res;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;,</span><br><span class="line">		logout: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">			auth.setToken();</span><br><span class="line">			auth.setUser();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Now for the templates. Here’s the abstract one in <strong>public/templates/auth/main.html</strong>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'text-center'</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"btn-group btn-group-justified"</span> <span class="attribute">role</span>=<span class="value">"group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">a</span> <span class="attribute">ui-sref</span>=<span class="value">"auth.login"</span> <span class="attribute">ui-sref-active</span>=<span class="value">'active'</span> <span class="attribute">class</span>=<span class="value">"btn btn-default"</span> <span class="attribute">role</span>=<span class="value">"button"</span>&gt;</span>Login<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">a</span> <span class="attribute">ui-sref</span>=<span class="value">"auth.register"</span> <span class="attribute">ui-sref-active</span>=<span class="value">'active'</span> <span class="attribute">class</span>=<span class="value">"btn btn-default"</span> <span class="attribute">role</span>=<span class="value">"button"</span>&gt;</span>Register<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'col-sm-6 col-sm-offset-3'</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>and then the login and register angular-formly layouts are minimal.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">h3</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">name</span>=<span class="value">'loginForm'</span> <span class="attribute">ng-submit</span>=<span class="value">'login(userCreds)'</span> <span class="attribute">novalidate</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">formly-form</span> <span class="attribute">model</span>=<span class="value">'userCreds'</span> <span class="attribute">fields</span>=<span class="value">'loginFields'</span> <span class="attribute">form</span>=<span class="value">'loginForm'</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span> <span class="attribute">class</span>=<span class="value">'btn btn-primary'</span> <span class="attribute">ng-disabled</span>=<span class="value">"loginForm.$invalid"</span>&gt;</span>Login<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">formly-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>and…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">h3</span>&gt;</span>Create a new account<span class="tag">&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">name</span>=<span class="value">'registerForm'</span> <span class="attribute">ng-submit</span>=<span class="value">'register(newUser)'</span> <span class="attribute">novalidate</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">formly-form</span> <span class="attribute">model</span>=<span class="value">'newUser'</span> <span class="attribute">fields</span>=<span class="value">'registerFields'</span> <span class="attribute">form</span>=<span class="value">'registerForm'</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span> <span class="attribute">class</span>=<span class="value">'btn btn-success'</span> <span class="attribute">ng-disabled</span>=<span class="value">"registerForm.$invalid"</span>&gt;</span>Register<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">formly-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>That is pretty much it. It is worth noting any app can send these requests to this server. The server sends and validates tokens. The server does not need to maintain sessions. The browser’s localStorage is also really helpful with this examples. If you have questions <a href="https://twitter.com/cleechtech" target="_blank" rel="external">hit me up on twitter</a>.</p>

	</div>
</div>
	</div>
</body>
</html>