<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<!-- Use Part 3 - Add angular-ui-router to a Ruby On Rails app for dynamic title -->
	<title>El Blogo de Connor</title>

	<!-- Twitter bootstrap (via cdn) -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	<!-- assets located in source folder -->
	<link rel="stylesheet" href="/css/main.css">

</head>

<div class='row text-center'>
	<form action="//github.us5.list-manage.com/subscribe/post?u=0713e0ac2a414eae4ca4bb786&amp;id=0bdf2bdb00" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="navbar-form" target="_blank" novalidate>
	    <div class="form-group">
	    	<label for="mce-EMAIL">Get notified when I post a new tutorial!</label>
		    <input type="email" value="" name="EMAIL" class="form-control" placeholder="Email address" required>
		    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		    <div style="position: absolute; left: -5000px;" aria-hidden="true">
		    	<input type="text" name="b_0713e0ac2a414eae4ca4bb786_0bdf2bdb00" tabindex="-1" value="">
		    </div> 	
	    </div>
	    <input type="submit" value="Submit" name="subscribe" class="btn btn-warning">
	</form>
</div>
<body id='wrapper'>
	<div class='hideOverflow'>
		<div class='container blog-post'>
	<div class='row'>
		<div class='col-sm-12'>
			<a href='/' class="btn btn-yellow btn-circle" style='color:grey;'>
            	<i class="fa fa-home fa-2"></i>
        	</a>
		</div>
	</div>
	<div class='row'>
		<h1 class='author-name'>Part 3 - Add angular-ui-router to a Ruby On Rails app</h1>
	    2015-12-14 
	    <hr />
		<p><strong>tldr;</strong> — <a href="https://github.com/cleechtech/rails-task-list" target="_blank" rel="external">source code on github</a> (give it a star!)</p>
<p>In <a href="http://cleechtech.github.io/2015/12/02/Ruby-On-Rails-%E2%80%94-Introduction-for-the-total-n00b/">part 1</a> and <a href="http://cleechtech.github.io/2015/12/04/Add-Angular-js-to-Ruby-on-Rails-app/">part 2</a> we set up a Ruby On Rails app with some static data and added angular and bower. In this post we will set up routing and request the list of tasks using angular instead of the rails template language.</p>
<a id="more"></a>
<h3 id="Make_Rails_routes">Make Rails routes</h3><p>In <strong>config/routes.rb</strong> we are going to set up the task index template as the route. Any request that is unmatched (as a fallback) will also serve the index template. Angular is on the index template so most routing our users see will happen through angular.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  root :to =&gt; <span class="string">"task#index"</span></span><br><span class="line">  <span class="literal">get</span> <span class="string">"*unmatched_route"</span> =&gt; <span class="string">"task#index"</span></span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>
<p>Then in <strong>views/task/index.html.erb</strong> add a space where the routing will occur:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="type">class</span>=’container’&gt;</span><br><span class="line"> &lt;<span class="keyword">div</span> ui-view&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure>
<p>Next up we are going to use <a href="https://github.com/pitr/angular-rails-templates" target="_blank" rel="external">angular-rails-templates</a>. In the <strong>Gemfile</strong> add</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem ‘angular-rails-templates’</span><br><span class="line">gem ‘sprockets’, ‘<span class="number">2.12</span><span class="number">.3</span>’</span><br></pre></td></tr></table></figure>
<p>In order for this gem to work we need at least sprockets 2.12. The default sprockets for a rails 4 app (as of this writing is 2.11). You can update sprockets by running</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">bundle </span>update sprockets</span><br></pre></td></tr></table></figure>
<p>Side note, if you get an error when running bundle install with SSL certificates like:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Gem:</span>:<span class="string">RemoteFetcher:</span>:<span class="string">FetchError:</span> SSL_connect returned=<span class="number">1</span> errno=<span class="number">0</span> state=SSLv3 read server certificate <span class="string">B:</span> certificate verify failed (<span class="string">https:</span><span class="comment">//rubygems.org/gems/rack-1.5.5.gem)</span></span><br></pre></td></tr></table></figure>
<p>then change your gemfile to <code>source ‘http://rubygems.org&#39;</code> instead of <code>&#39;https://rubygems.org&#39;</code>. One letter change gets rid of the error.</p>
<h3 id="Write_angular_routes">Write angular routes</h3><p>In <strong>app/assets/javascripts/application.js</strong> add the javascript libraries we need.</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/= require angular/angular</span></span><br><span class="line">/<span class="regexp">/= require angular-ui-router/release</span><span class="regexp">/angular-ui-router</span><br><span class="line">/</span><span class="regexp">/= require angular-rails-templates</span><br><span class="line">/</span><span class="regexp">/= require_tree ../templates</span></span><br></pre></td></tr></table></figure>
<p>The last line here means that our client side templates live in <strong>app/assets/templates</strong>. So create that folder.</p>
<p>Next add a module dependency to angular and define our tasks route.</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module(‘rails-task-list’, [</span><br><span class="line"> ‘ui.router’,</span><br><span class="line"> ‘templates’</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">app.config([</span><br><span class="line"> ‘<span class="variable">$stateProvider</span>’, </span><br><span class="line"> ‘<span class="variable">$urlRouterProvider</span>’, </span><br><span class="line"> ‘<span class="variable">$locationProvider</span>’, </span><br><span class="line"> <span class="keyword">function</span>(<span class="variable">$stateProvider</span>, <span class="variable">$urlRouterProvider</span>, <span class="variable">$locationProvider</span>)&#123;</span><br><span class="line">     <span class="variable">$stateProvider</span>.state(‘tasks’, &#123;</span><br><span class="line">          url: ‘/’,templateUrl: ‘tasks.html’,</span><br><span class="line">          controller: ‘TaskCtrl’</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$urlRouterProvider</span>.otherwise(‘/’);</span><br><span class="line">    <span class="variable">$locationProvider</span>.html5Mode(&#123;</span><br><span class="line">       enabled:true,</span><br><span class="line">       requireBase: false</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;]);</span><br></pre></td></tr></table></figure>
<p>Create <strong>app/assets/templates/tasks.html</strong></p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">’container’</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">’row</span> <span class="attribute">text-center</span>’&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">h2</span>&gt;</span>Task List<span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">ul</span> <span class="attribute">class</span>=<span class="value">’list-group’</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">li</span> <span class="attribute">class</span>=<span class="value">’list-group-item’</span> <span class="attribute">ng-repeat</span>=<span class="value">’task</span> <span class="attribute">in</span> <span class="attribute">tasks</span>’&gt;</span></span><br><span class="line"> </span><span class="expression">&#123;&#123;<span class="variable">task.title</span>&#125;&#125;</span><span class="xml"></span><br><span class="line"> <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>Now in our controller send the request for the tasks:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.controller(‘TaskCtrl’, [</span><br><span class="line"> ‘<span class="variable">$scope</span>’,</span><br><span class="line"> ‘<span class="variable">$http</span>’,</span><br><span class="line"> <span class="keyword">function</span>(<span class="variable">$scope</span>, <span class="variable">$http</span>)&#123;</span><br><span class="line">     <span class="variable">$scope</span>.taks = [];</span><br><span class="line">     <span class="variable">$http</span>.get(‘/api/v1/tasks’).then(function(res)&#123;</span><br><span class="line">         console.log(res.data);</span><br><span class="line">         <span class="variable">$scope</span>.tasks = res.data;</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>Send JSON with Rails Our angular routing is set up and we are ready to handle the JSON response. Now we need to set up the “/api/v1/tasks” endpoint. In <strong>config/routes.rb</strong> add our api definition.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="operator"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">scope</span> ‘/api’ <span class="keyword">do</span></span><br><span class="line"> <span class="keyword">scope</span> ‘/v1’ <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">scope</span> ‘/tasks’ <span class="keyword">do</span></span><br><span class="line">     <span class="keyword">get</span> ‘/’ =&gt; ‘task#all’</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> root :<span class="keyword">to</span> =&gt; “task#<span class="keyword">index</span>”</span><br><span class="line"> <span class="keyword">get</span> “*unmatched_route” =&gt; “task#<span class="keyword">index</span>”</span><br><span class="line"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<p>This says that when we hit “/api/v1/tasks” invoke the all method in TaskController. Remember, this is our rails task ctrl, not our angular task controller. Define the all method on the TaskController in <strong>app/controllers/task_controller.rb</strong> so that it looks like:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="inheritance">&lt; <span class="parent">ApplicationController</span></span></span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all</span></span></span><br><span class="line"> render <span class="symbol">json:</span> <span class="constant">Task</span>.all</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>So here the “index” method will render the html page. The “all” method will send all of the tasks to the client as json, then angular will render them. To see the raw JSON point your browser to <code>http://localhost:3000/api/v1/tasks</code>.</p>
<h3 id="Conclusion">Conclusion</h3><p>In this tutorial we set up angular.js routing for our Ruby On Rails app. We serve client side templates and fetch data asynchronously using angular.js. You can <a href="https://github.com/cleechtech/rails-task-list" target="_blank" rel="external">check out the source code</a>. Give it a <a href="https://github.com/cleechtech/rails-task-list/stargazers" target="_blank" rel="external">star</a> if you find it helpful. Also you can ask me questions <a href="https://twitter.com/realjasonshark" target="_blank" rel="external">on twitter</a>.</p>

	</div>
</div>
	</div>
</body>
</html>